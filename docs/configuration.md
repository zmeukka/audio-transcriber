# ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

## üìÅ –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ `config.yaml` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

```yaml
# Directory paths
shared_directory: "shared"                    # –ï–¥–∏–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

# WhisperX default settings (used when parameters not specified in API request)
whisperx:
  model_size: "base"                          # tiny, base, small, medium, large
  language: "ru"                              # Language code (ru, en, etc.)
  temperature: 0.1                            # Temperature for transcription (0.1 for better accuracy)
  compute_type: "int8"                        # float32, float16, int8 (int8 works well)
  device: "cpu"                               # cpu, cuda
  debug: false                                # Enable debug output

# Processing settings
processing:
  max_retry_attempts: 3                       # Maximum retry attempts
  file_check_attempts: 3                      # File existence check attempts (reduced from 5)
  file_check_interval_seconds: 1              # Interval between file checks
  processing_timeout_minutes: 10              # Max wait time for processing (reduced from 30)
  status_polling_interval_seconds: 10         # Interval for status polling (reduced from 5)

# Queue settings
queue:
  priority_levels:
    api_request: 1                            # High priority (API requests)
    shared_scan: 2                            # Low priority (auto-discovered files)
  immediate_operations: ["DELETE"]            # Operations executed immediately, bypassing queue
```

## ü§ñ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã WhisperX

### üìä –†–∞–∑–º–µ—Ä—ã –º–æ–¥–µ–ª–µ–π (model_size)
| –†–∞–∑–º–µ—Ä | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –°–∫–æ—Ä–æ—Å—Ç—å | –¢–æ—á–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|--------|--------------|----------|----------|--------------|
| tiny   | ~39MB        | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ | –ë–∞–∑–æ–≤–∞—è | –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã |
| base   | ~74MB        | –ë—ã—Å—Ç—Ä–æ   | –•–æ—Ä–æ—à–∞—è  | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| small  | ~244MB       | –°—Ä–µ–¥–Ω–µ   | –õ—É—á—à–µ    | –ë–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞/—Å–∫–æ—Ä–æ—Å—Ç–∏ |
| medium | ~769MB       | –ú–µ–¥–ª–µ–Ω–Ω–æ | –í—ã—Å–æ–∫–∞—è  | –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| large  | ~1550MB      | –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |

### üåç –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏ (language)
| –ö–æ–¥ | –Ø–∑—ã–∫ | –ö–æ–¥ | –Ø–∑—ã–∫ |
|-----|------|-----|------|
| ru  | –†—É—Å—Å–∫–∏–π | en  | –ê–Ω–≥–ª–∏–π—Å–∫–∏–π |
| es  | –ò—Å–ø–∞–Ω—Å–∫–∏–π | fr  | –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π |
| de  | –ù–µ–º–µ—Ü–∫–∏–π | it  | –ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π |
| pt  | –ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π | pl  | –ü–æ–ª—å—Å–∫–∏–π |
| uk  | –£–∫—Ä–∞–∏–Ω—Å–∫–∏–π | ja  | –Ø–ø–æ–Ω—Å–∫–∏–π |
| ko  | –ö–æ—Ä–µ–π—Å–∫–∏–π | zh  | –ö–∏—Ç–∞–π—Å–∫–∏–π |

### üî• –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (temperature)
- **0.0** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è
- **0.1** - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- **0.5** - –ë–∞–ª–∞–Ω—Å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **1.0** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ

### ‚ö° –¢–∏–ø—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (compute_type)
| –¢–∏–ø | –¢–æ—á–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ü–∞–º—è—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|-----|----------|----------|--------|--------------|
| float32 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | –ú–µ–¥–ª–µ–Ω–Ω–æ | –ú–Ω–æ–≥–æ | –î–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π |
| float16 | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ | –°—Ä–µ–¥–Ω–µ | –ë–∞–ª–∞–Ω—Å –¥–ª—è GPU |
| int8 | –•–æ—Ä–æ—à–∞—è | –ë—ã—Å—Ç—Ä–æ | –ú–∞–ª–æ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è CPU |

### üñ•Ô∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (device)
- **cpu** - –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ)
- **cuda** - GPU Nvidia (—Ç—Ä–µ–±—É–µ—Ç CUDA, –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ)

## üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∞
```yaml
model_cache:
  max_models_in_memory: 3                     # –ú–∞–∫—Å–∏–º—É–º –º–æ–¥–µ–ª–µ–π –≤ –ø–∞–º—è—Ç–∏
  preload_models: ["tiny", "base"]            # –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏
  cache_timeout_minutes: 30                   # –í—Ä–µ–º—è –¥–æ –≤—ã–≥—Ä—É–∑–∫–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –º–æ–¥–µ–ª–∏
```

### üìÇ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫—ç—à–∞
- **–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:** `/root/.cache/whisper`
- **–ù–∞ —Ö–æ—Å—Ç–µ:** `./whisper_cache` (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è)

### ‚ö° –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
1. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞** - –º–æ–¥–µ–ª–∏ –∏–∑ `preload_models` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
2. **LRU –∫—ç—à** - –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ `max_models_in_memory`
3. **Timeout** - –º–æ–¥–µ–ª–∏ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `cache_timeout_minutes` –º–∏–Ω—É—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
CONFIG_PATH=/app/config.yaml                 # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
LOG_LEVEL=INFO                              # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG/INFO/WARNING/ERROR)

# WhisperX –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç config.yaml)
WHISPERX_MODEL_SIZE=base                    # –†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
WHISPERX_LANGUAGE=ru                        # –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
WHISPERX_DEVICE=cpu                         # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
MAX_MODELS_IN_MEMORY=3                      # –ú–∞–∫—Å–∏–º—É–º –º–æ–¥–µ–ª–µ–π –≤ –ø–∞–º—è—Ç–∏
PROCESSING_TIMEOUT=3600                     # –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
```

## üèóÔ∏è Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### üìÅ –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–º–æ–≤
```yaml
volumes:
  - ./shared:/app/shared                    # –û–±—â–∏–µ —Ñ–∞–π–ª—ã
  - ./whisper_cache:/root/.cache/whisper    # –ö—ç—à –º–æ–¥–µ–ª–µ–π
  - ./config.yaml:/app/config.yaml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### üîå –ü–æ—Ä—Ç—ã
```yaml
ports:
  - "8000:8000"                            # API —Å–µ—Ä–≤–µ—Ä
```

### üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Docker
```yaml
environment:
  - LOG_LEVEL=INFO
  - WHISPERX_DEVICE=cpu
  - MAX_MODELS_IN_MEMORY=3
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### üè• Health check
–≠–Ω–¥–ø–æ–∏–Ω—Ç `/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```json
{
  "status": "healthy",
  "config": {
    "whisperx": {
      "model_size": "base",
      "language": "ru",
      "device": "cpu"
    },
    "models_loaded": ["tiny", "base"],
    "memory_usage_mb": 1024
  }
}
```

### üîÑ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `config.yaml` —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö
